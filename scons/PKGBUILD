# POWER Maintainer: Alexander Baldeck <alex.bldck@gmail.com>
# Maintainer: David Runge <dvzrv@archlinux.org>
# Contributor: Ray Rashif <schiv@archlinux.org>
# Contributor: damir <damir@archlinux.org>
# Contributor: Lukas Sabota <punkrockguy318@comcast.net>
# Contributor: Brice Carpentier <brice@dlfp.org>

pkgname=scons
pkgver=4.3.0
pkgrel=1
pkgdesc="Extensible Python-based build utility"
arch=('any')
url="https://scons.org"
license=('MIT')
depends=('python')
makedepends=('python-setuptools' 'python-sphinx' 'python-sphinx_rtd_theme'
'rst2pdf')
checkdepends=('python-pytest')
source=("$pkgname-$pkgver::git+https://github.com/${pkgname}/${pkgname}.git#tag=${pkgver}")
sha256sums=('SKIP')

prepare() {
  cd "${pkgname}-${pkgver}"
  # fix wrong build target
  sed -e 's/bdist_wheel/bdist/g' -i SConstruct
}

build() {
  cd "${pkgname}-${pkgver}"
  python scripts/scons.py --include-dir= -j1
  # copy man pages into place, so that install-data may pick them up
  cp -av build/doc/man/* .
}

check() {
  cd "${pkgname}-${pkgver}"
  python runtest.py --all --unit-only
}

package() {
  cd "${pkgname}-${pkgver}"
  export PYTHONHASHSEED=0
  python setup.py install --prefix=/usr \
                          --skip-build \
                          --optimize=1 \
                          --install-data=/usr/share/man/man1/ \
                          --root="$pkgdir"
  install -vDm 644 LICENSE -t "${pkgdir}/usr/share/licenses/${pkgname}/"
  install -vDm 644 {{CHANGES,RELEASE}.txt,README.rst} \
    -t "${pkgdir}/usr/share/doc/${pkgname}/"
}
