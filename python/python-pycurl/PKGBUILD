# POWER Maintainer: Alexander Baldeck <alex.bldck@gmail.com>
# Maintainer: Felix Yan <felixonmars@archlinux.org>
# Contributor: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Angel 'angvp' Velasquez <angvp[at]archlinux.com.ve>

pkgname=python-pycurl
pkgver=7.45.0
pkgrel=1
pkgdesc="A Python 3.x interface to libcurl"
arch=(x86_64 powerpc64le powerpc riscv64)
url="http://pycurl.sourceforge.net/"
license=('LGPL' 'MIT')
depends=('python' 'curl')
makedepends=('python-setuptools')
checkdepends=('python-bottle' 'python-pytest' 'vsftpd' 'python-flaky' 'python-pyflakes')
source=("https://github.com/pycurl/pycurl/archive/REL_${pkgver//./_}/$pkgname-$pkgver.tar.gz")
sha512sums=('93a80d1e61c3776897d105a14892c1aec97dc7987dcfb1fc9cdc8f7d19de07d7d01c09dba6d5a4dbb8307a08ab62004789b26062ea35a30c207f1dfef203a5a5')

prepare() {
  mv pycurl-REL_${pkgver//./_} pycurl-$pkgver
}

build() {
  cd pycurl-$pkgver
  make
  python setup.py build
}

check() {
  export PYCURL_VSFTPD_PATH=vsftpd
  # We don't have HTTP2 enabled

  cd pycurl-$pkgver
  PYTHONPATH="$PWD/build/lib.linux-$CARCH-3.10:$PYTHONPATH" make test || warning "Tests failed"
}

package() {
  cd pycurl-$pkgver
  python setup.py install -O1 --root="$pkgdir"
  install -Dm644 COPYING-MIT -t "$pkgdir"/usr/share/licenses/$pkgname/
}
